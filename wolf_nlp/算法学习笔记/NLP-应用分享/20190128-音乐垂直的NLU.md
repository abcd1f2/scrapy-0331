## NLP-应用分享 - 音乐垂域的自然语言理解
- **概述：**
>       本篇文章主要介绍一下小米智能云-秦斌老师分享《音乐垂直领域的NLU》
>       语义理解：
>           如飞机票领域，要理解用户的意图，是购票还是退票
>           如音乐领域，是要找到歌手、听歌、还是要找一个推荐
>           在意图理解后抽取Slot(一个个的字段)，如时间、出发地、目的地等
>           整体就是将一个纯文本机构化，将相关信息抽取出来，这就是做语义理解经常要做的事情
>

- **音乐垂直领域意图搜索：**
>
>       1、从Query中抽取"歌手/歌曲/专辑/标签"四个字段信息
>           如：播放英文版柠檬树      抽取：song=柠檬树 tag=英文
>       2、对"歌手/歌曲/专辑/标签"字段进行消歧
>           如：放三生三世十里桃花的歌       抽取：album=三生三世十里桃花（优先播放song：凉凉）
>       3、对"歌手/歌曲/专辑/标签"字段进行纠错
>           如：韩磊南上南     抽取：artist=张磊 song=南山南
>
>       音乐意图处理中的一些特殊情况：
>           1、上下文继承，对字段信息进行信息不全或指代消解
>               如：Q1:我想听刘德华的歌 Q2：播放他的笨小孩儿
>               抽取：artist=刘德华 song=笨小孩
>           2、用户情感分析，识别对指定字段的否定意图
>               如：我想听岁月神偷不要听金玟岐的
>               抽取：artist=!金玟岐 song=岁月神偷
>           3、识别指定播放模式（顺序/循环）的意图
>               如：循环播放刘德华的歌
>               抽取：artist=刘德华 mode=循环
>           4、根据歌词内容识别歌曲
>               如：海草海草
>               抽取：song=海草舞
>           5、收听历史
>               如：Q1：昨天听过的歌
>                   Q2：我昨天听过的儿歌
>

- **技术挑战：**
>
>       实体名的复杂性：
>           实体名形式多样：
>               实体名数量众多且形式自由，没有固定、清晰的组成规则，尤其是歌曲名
>           知识库数据量大：
>               音乐领域历史悠久，设计古今中外庞大的知识数据，QQ1500w，网易500w，阿里300w
>           要求高质量的知识库数据：
>               原始数据存在大量的噪音，缺少字段信息。如何建立完整的音乐知识库，清洗数据，打上准确的标签等都是复杂有挑战的工作
>       半结构化文本：
>           输入文本形式多样：
>               允许输入形式为半结构化的文本，不完全符合自然语言规则，比较简短，没有固定形式
>       实体名纠错：
>           纠错形式多样：
>               由于实体名自身的复杂性和多义性，存在着同音纠错、方言纠错、乱序纠错等多种纠错情况
>

- **音乐NLU架构：**
>
>       音乐NLU方案：
>           知识库很多，实体名很复杂，单纯用词不能很好的解决这个问题，所以采用了知识库加搜索的方案
>           搜索能很容易解决数百万知识库，不存在性能问题，搜索排序算法比较成熟，搜索还保留了歌的物理信息，如"王菲红豆"就是红豆这首歌，但是"韩红红豆"就不是歌。
>           如下图，
>
>![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU.jpg)
>
>           进入知识库后会有一个文本搜索，抽取feature，利用learn to rank排序，通过query确定用户想听哪首歌，抽取slot，利用GBDT模型打分。还有user feedback，language model，
>               domain frequency（利用用户行为反馈，改善向量效果）。后面就是个性化推荐的搜索和推荐。
>           总结流程：
>               大致流程会对query做一些前置理解，后续从知识库中找到与之相关的歌，抽取slot，然后进行语义消歧，然后打分，然后利用语言模型判断是否符合常用规则。！！！
>
>       音乐NLU架构：
>           如下图
>
> ![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU_architecture.jpg)
>
>           音乐NLU整体架构，按照以下步骤顺序进行：
>               1、意图抽取
>                   意图抽取会对query进行预分析，数据预处理，然后分词，然后推荐意图分类器，然后文法规则，最后找到一些主干query供后续搜索，
>                       先理解query语义上的可能的一些倾向性的方向判断，在找到主干query供第二部分使用
>               2、知识库搜索排序
>               3、字段抽取
>               4、路径选择及打分
>               5、线上数据反馈
>

- **意图抽取以及推荐意图分类算法：**
>
>       **推荐意图分类器：**
>           在获取query时，增加了一个二分类判断，判断是否是推荐意图，目的是简化搜索，节省时间，同时为策略判断给出一些特例。
>       推荐意图分类器详解：
>           如下图
>
> ![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU_recommend_classification.jpg)
>
>           1、分词
>           2、抽取n-gram特征（如单词特征，二元特征，三元特征）
>           3、利用逻辑回归进行分类
>           （后面可能会使用到word2vec，word2vec可以捕捉多语法和语义特征）
>
>       **意图抽取：文法规则匹配**
>           如下图，
>
> ![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU_grammar_match.jpg)
>
>           文法规则匹配中，自定义了一套文法规则，支持变量的定义、文法的组合、文法替代，目的是对query语义做倾向性判断。
>           还有影视类、标签类的词典，标签文法对标签进行了强分类（强标签、弱标签）
>
>           第二部分就是知识库搜索排序，基于Linden做的搜索。Linden是基于开源的Lucene包。
>               单词搜索主要针对用户说法很乱，如果进行分词可能无法召回，但是出现的问题是召回太多，所以最后会对初排后结果learn to rank进行重排。
>
>
>       **知识库搜索排序：**
>           如下图，
>
>![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU_knowledge_search_rank.jpg)
>
>           在初排后进入中间层会利用排序算法进行二次排序，如从top80里面选择一个最相似的文档。
>           正负样本失衡，适用于Learn to rank算法，最后选用LamdaMart，采用决策树模型会学习到很多特征组合。
>           模型有字段匹配类型、相似度、字段匹配长度、字段纠错类别、文档热度等50多个相关特征。
>

- **字段抽取：**
>
>       如下图，
> ![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU_extract_slot.jpg)
>
>       通过相关特征选择一首歌后，进行字段抽取，字段抽取涉及到资源字段的抽取和纠错，标签字段PK资源字段，如：判断青春是歌手还是歌名、上下文字段继承、否定意图等。
>       **字段抽取是基于纯规则**，有些热门歌曲唱错时也会将其选择出来，如一个歌手没有唱过这首歌，但是如果是热门歌曲也会选择出来。
>

- **路径选择及打分模块：**
>
>       如下图，
> ![avatar](https://github.com/nwaiting/wolf-ai/blob/master/wolf_others/pic/xiaomi_music_NLU_path_score.jpg)
>
>       打分是基于意图分类和规则打分，还有基于语言路径的用户选择，由于语言的歧义性可能会选择多条路径，典型的二分类问题，**缺少其他domain打分信息结合少量必要规则**，替代原有规则系统。
>       **最终选定GCDT算法**，利用各种特征，如：职业特征，郭德纲，岳云鹏都唱过歌，但是职业是相声演员，单说歌手会将其推荐给电台。
>       还有一个优势是APP搜索日志，小米音乐大都是key-value搜索，如果在日志中找到也是属于音乐特征。
>

- **线上数据反馈模块：**
>
>       就是收集用户的行为记录，如是否听过这首歌，听了多久等，反馈更新修正模型
>
>
>
>
>
>
>
>


- **待续：**
>       参考：https://mp.weixin.qq.com/s/1caubBnVCzweUvT3If9iOg
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
