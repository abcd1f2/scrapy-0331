## linux - 内存分配
- **概述：**
>       内存的延迟分配，系统开始只为进程分配一块虚拟内存，当使用这块内存时，内核才会分配具体的物理内存页面给用户。
>       glibc对于heap内存申请大于128K的空间，glibc采用mmap的方式向内存申请内存。小于128K的采用brk，128K是阈值。
>       大块内存申请：
>           glibc直接使用mmap系统调用申请一块虚拟地址，供进程单独使用，使用unmmap系统调用进行释放，过程中不会产生内存碎片。
>       内核内存释放：
>           当glibc发现堆顶有连续的128K空间是空闲的时候，通过brk或sbrk系统调用，来调整heap顶的位置，将占用的内存返回给系统。
>           内存会通过删除相应的线性区，释放占用的物理内存
>           只要堆顶的部分申请内存还在占用，在下面释放的内存再多，都不会被返回到系统中，仍然占用着物理内存，为什么这样设计？
>           因为：
>               内核处理堆的时候，过于简单，只能通过调整堆顶指针的方式来调整程序占用的线性区（虚拟内存）
>               而又只能通过调整线性区的方式，来释放内存。
>           所以只要堆顶不减小，占用的内存就不会释放。
>
>       glibc申请内存：
>           glibc为每一块内存维护了一个chunk结构，内存申请时，最少分配16个字节，以便能够维护chunk结构
>
>       查看机器可用内存：
>           linux系统中，会尽可能的cache和buffer一些数据，方便下次使用，所以一般free很小
>           可用内存 = free + buffers + cached = total - used
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>

- **待续：**
>       https://blog.csdn.net/fivedoumi/article/details/7057253     内存分配——深入浅出
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
