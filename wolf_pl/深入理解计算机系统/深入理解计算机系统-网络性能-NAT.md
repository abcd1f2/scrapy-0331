## 深入理解计算机系统 - 网络性能 - NAT
- **概述**
>
>       发现网络延迟增大的情况后，可以先从路由、网络包的收发、网络包的处理，再到应用程序等，从各个层级分析网络延迟，等到找出网络延迟的来源层级后，再深入定位瓶颈所在。
>

- **NAT原理：**
>       NAT 技术可以重写 IP 数据包的源 IP 或者目的 IP，被普遍地用来解决公网 IP 地址短缺的问题。
>           主要原理就是，网络中的多台主机，通过共享同一个公网 IP 地址，来访问外网资源。同时，由于 NAT 屏蔽了内网网络，自然也就为局域网中的机器提供了安全隔离。
>
>       既可以在支持网络地址转换的路由器（称为 NAT 网关）中配置 NAT，也可以在 Linux服务器中配置 NAT。
>           如果采用第二种方式，Linux 服务器实际上充当的是“软”路由器的角色。
>
>       根据实现方式的不同，NAT 可以分为三类：
>           1、静态 NAT
>               即内网 IP 与公网 IP 是一对一的永久映射关系；
>           2、动态 NAT
>               即内网 IP 从公网 IP 池中，动态选择一个进行映射；
>           3、网络地址端口转换 NAPT
>               网络地址端口转换 NAPT（Network Address and Port Translation），即把内网 IP 映
>           4、射到公网 IP 的不同端口上，让多个内网 IP 可以共享同一个公网 IP 地址。
>       注：
>           NAPT 是目前最流行的 NAT 类型，我们在 Linux 中配置的 NAT 也是这种类型。
>
>       NAPT 分为三类：
>           1、源地址转换 SNAT，即目的地址不变，只替换源 IP 或源端口。
>               SNAT 主要用于，多个内网 IP 共享同一个公网 IP ，来访问外网资源的场景。
>           2、目的地址转换 DNAT，即源 IP 保持不变，只替换目的 IP 或者目的端口
>               DNAT主要通过公网 IP 的不同端口号，来访问内网的多种服务，同时会隐藏后端服务器的真实IP 地址。
>           3、双向地址转换，即同时使用 SNAT 和 DNAT。
>               当接收到网络包时，执行DNAT，把目的 IP 转换为内网 IP；而在发送网络包时，执行 SNAT，把源 IP 替换为外部IP。
>
>       在使用 iptables 配置 NAT 规则时，Linux 需要转发来自其他 IP 的网络包，所以你千万不要忘记开启 Linux 的 IP 转发功能。
>           查看这一功能是否开启。如果输出的结果是 1，就表示已经开启了 IP 转发：
>               sysctl net.ipv4.ip_forward
>           写入配置：
>               sysctl -w net.ipv4.ip_forward=1
>           为了避免重启后配置丢失，不要忘记将配置写入 /etc/sysctl.conf 文件中
>
>

- **NAT 性能问题：**
>       
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>

- **待续：**
>       参考：
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
